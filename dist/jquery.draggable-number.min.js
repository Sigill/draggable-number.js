/**!
 * draggable-number.js
 * Minimal numeric input widget
 *
 * @license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 * @author David Mignot - http://idflood.com
 * @version 0.0.3
 **/
!function(a,b){"object"==typeof exports?module.exports=b(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],b):a.DraggableNumber=b(a.jQuery)}(this,function(a){var b=function(a){this.elements=a,this.instances=[],this.init()};b.prototype={constructor:b,init:function(){this.elements&&this.elements instanceof Array==!1&&this.elements instanceof NodeList==!1&&(this.elements=[this.elements]);for(var a=this.elements.length-1;a>=0;a--)this.instances.push(new b.Element(this.elements[a]))},destroy:function(){for(var a=this.instances.length-1;a>=0;a--)this.instances[a].destroy()}},b.MODIFIER_NONE=0,b.MODIFIER_LARGE=1,b.MODIFIER_SMALL=2;var c=function(a,b){return function(){return a.apply(b,arguments)}};return b.Element=function(a){this._input=a,this._span=document.createElement("span"),this._isDragging=!1,this._lastMousePosition={x:0,y:0},this._value=0,this._dragThreshold=10,this._inputDisplayStyle="",this._spanDisplayStyle="",this._init()},b.Element.prototype={constructor:b.Element,_init:function(){this._value=parseFloat(this._input.value,10),this._addSpan(),this._inputDisplayStyle=this._input.style.display,this._spanDisplayStyle=this._span.style.display,this._input.style.display="none",this._onMouseUp=c(this._onMouseUp,this),this._onMouseMove=c(this._onMouseMove,this),this._onMouseDown=c(this._onMouseDown,this),this._onInputBlur=c(this._onInputBlur,this),this._onInputKeyDown=c(this._onInputKeyDown,this),this._onInputChange=c(this._onInputChange,this),this._span.addEventListener("mousedown",this._onMouseDown,!1),this._input.addEventListener("blur",this._onInputBlur,!1),this._input.addEventListener("keypress",this._onInputKeyDown,!1),this._input.onchange=this._onInputChange},set:function(a){this._value=a,this._input.value=this._value,this._span.innerHTML=this._value},get:function(){return this._value},destroy:function(){this._span.parentNode&&this._span.parentNode.removeChild(this._span)},_preventSelection:function(a){var b="none";a===!1&&(b="all"),document.body.style["-moz-user-select"]=b,document.body.style["-webkit-user-select"]=b,document.body.style["-ms-user-select"]=b,document.body.style["user-select"]=b},_addSpan:function(){var a=this._input.parentNode;a.insertBefore(this._span,this._input),this._span.innerHTML=this.get(),this._span.style.cursor="col-resize"},_showInput:function(){this._input.style.display=this._inputDisplayStyle,this._span.style.display="none",this._input.focus()},_showSpan:function(){this._input.style.display="none",this._span.style.display=this._spanDisplayStyle},_onInputBlur:function(){this._onInputChange(),this._showSpan()},_onInputChange:function(){this.set(parseFloat(this._input.value,10))},_onInputKeyDown:function(a){var b=13;a.charCode==b&&this._input.blur()},_onMouseDown:function(a){this._preventSelection(!0),this._isDragging=!1,this._lastMousePosition={x:a.clientX,y:a.clientY},document.addEventListener("mouseup",this._onMouseUp,!1),document.addEventListener("mousemove",this._onMouseMove,!1)},_onMouseUp:function(){this._preventSelection(!1),this._isDragging===!1&&this._showInput(),this._isDragging=!1,document.removeEventListener("mouseup",this._onMouseUp,!1),document.removeEventListener("mousemove",this._onMouseMove,!1)},_hasMovedEnough:function(a,b){return Math.abs(a.x-b.x)>=this._dragThreshold||Math.abs(a.y-b.y)>=this._dragThreshold?!0:!1},_onMouseMove:function(a){var c={x:a.clientX,y:a.clientY};if(this._hasMovedEnough(c,this._lastMousePosition)&&(this._isDragging=!0),this._isDragging!==!1){var d=b.MODIFIER_NONE;a.shiftKey?d=b.MODIFIER_LARGE:a.ctrlKey&&(d=b.MODIFIER_SMALL);var e=this._getLargestDelta(c,this._lastMousePosition),f=this._getNumberOffset(e,d);this.set(this.get()+f),this._lastMousePosition=c}},_getNumberOffset:function(a,c){var d=1;return c==b.MODIFIER_SMALL?d*=.1:c==b.MODIFIER_LARGE&&(d*=10),0>a&&(d*=-1),d},_getLargestDelta:function(a,b){var c={x:a.x-b.x,y:a.y-b.y};return Math.abs(c.x)>Math.abs(c.y)?c.x:-1*c.y}},a.fn.draggableNumber=function(){return this.each(function(){a.data(this,"draggableNumber")||a.data(this,"draggableNumber",new b.Element(this))})},b});